---
- name: create user
  become: yes
  user:
    name: "{{ username }}"
    password: "{{ password | password_hash('sha512') }}"
    groups: wheel
    state: present

- name: mkdirs
  become_user: "{{ username }}"
  become: yes
  file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  with_items:
    - ~/Documents
    - ~/Downloads

- name: Validate the sudoers file before saving
  become: yes
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^# %wheel ALL=(ALL:ALL) NOPASSWD: ALL'
    line: '%wheel ALL=(ALL:ALL) NOPASSWD: ALL'
    validate: /usr/sbin/visudo -cf %s
